<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta lang="en">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ChatPUA👍🏻</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .login-box {
      background-color: #fff;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      width: 400px;
    }
    .login-box h2 {
      margin-top: 0;
      font-size: 24px;
      text-align: center;
    }

    .login-box h6 {
      margin-top: 0;
      text-align: right;
    }

    .login-box input {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-sizing: border-box;
      width: 100%;
      height: 50px;
    }

    .login-box button{
      background-color: #333;
      color: #fff;
      border: 0;
      border-radius: 20px;
      cursor: pointer;
      padding: 10px;
      width: 20%;
      height: 100%;
      float: right;
    }

    .login-box button:hover{
        transition-duration: 0.3s;
        background-color: #45a049;
    }
    .interaction{
      border: 2px solid black;
      height: 300px;
      overflow-y: scroll;
      margin-bottom: 8px;
      border-radius: 10px;
    }
    .content{
      padding-left: 10px;
    }
    </style>
</head>
<body>
  <div class="container">
    <div class="login-box">
        <h2>ChatPUA👍🏻</h2>
        <h6 class="author">shitted by DINOREXNB</h6>
        <div class="interaction" id="interaction">       
        </div>
        <div>
          <input type="text" placeholder="let's chat!" name="text" id="query">
        </div>
        <div>
          <button type="submit" value="发送" id="submit">发送</button>
        </div>
    </div>
  </div>
  <script>
    const btn=document.getElementById("submit");
    const interaction=document.getElementById("interaction");
    var query;
    btn.addEventListener("click",()=>{
      if(document.getElementById("query").value!=''){
        console.log("已发送请求...");
        interaction.innerHTML=interaction.innerHTML+`<div class="content"><h3>You:</h3><p>${document.getElementById("query").value}</p></div>`;
        interaction.scrollTop=interaction.scrollHeight;
        query=document.getElementById("query").value;
        document.getElementById("query").value='';
        console.log("query: "+query);
        //发送请求
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://api.openai.com/v1/chat/completions');
        xhr.setRequestHeader('Authorization', 'Bearer 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');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
          if (xhr.status === 200) {
            console.log(xhr.responseText);
            let Response=JSON.parse(xhr.responseText);
            //增添回复
            interaction.innerHTML=interaction.innerHTML+`
            <div class="content">
              <h3>PUA:</h3>
              <p>${Response.choices[0].message.content}</p>
            </div>
            `;
            interaction.scrollTop=interaction.scrollHeight;
          } else {
            console.error('请求失败，状态码：' + xhr.status + '，错误信息：' + xhr.statusText);
          }
        };
        const data = {
          "model": "gpt-3.5-turbo",
          "messages": [
            {
              "role": "user",
              "content": query,
            }
          ],
          "temperature": 0.7
        };
        xhr.send(JSON.stringify(data));
      }
    })
  </script>
</body>
</html>